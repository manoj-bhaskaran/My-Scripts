# Pre-commit hooks configuration
# See https://pre-commit.com for more information

repos:
  # General hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-added-large-files
        args: ["--maxkb=10240"] # Standardized to 10MB (matching manual hook)
      - id: check-merge-conflict
      - id: detect-private-key

  # Custom local hooks for debug statement detection
  - repo: local
    hooks:
      - id: check-debug-statements
        name: Check for debug statements
        entry: python
        args:
          [
            "-c",
            'import re, sys, os; [sys.exit(1) for f in [os.path.join(r,fn) for r,_,fs in os.walk(".") for fn in fs if fn.endswith((".py",".js",".ts",".ps1")) and not any(x in r for x in [".git",".venv","venv","node_modules"])] if os.path.isfile(f) and re.search(r"Write-Debug.*TODO|print.*DEBUG|console\.log|debugger;", open(f,encoding="utf-8",errors="ignore").read())]',
          ]
        language: system
        pass_filenames: false
        files: \.(py|js|ts|ps1)$

  # Python hooks
  - repo: https://github.com/psf/black
    rev: 24.3.0
    hooks:
      - id: black
        language_version: python3.12

  - repo: https://github.com/PyCQA/pylint
    rev: v3.0.0
    hooks:
      - id: pylint
        args:
          [
            "--errors-only",
            "--disable=import-error,no-member,used-before-assignment,no-name-in-module,possibly-used-before-assignment",
          ]

  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.9
    hooks:
      - id: bandit
        args: ["-c", "pyproject.toml"]
        additional_dependencies: ["bandit[toml]"]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.7.1
    hooks:
      - id: mypy
        args:
          [
            --config-file=mypy.ini,
            --show-error-codes,
            --explicit-package-bases,
            "src/python/",
            "tests/python/",
          ]
        additional_dependencies:
          - types-requests
          - types-tqdm
          - types-python-dateutil
        pass_filenames: false
        # Start as informational (don't fail on errors)
        verbose: true
        # Make mypy informational only for now (don't fail pre-commit)
        stages: [manual]

  # Python security - dependency vulnerability scanning
  - repo: https://github.com/Lucas-C/pre-commit-hooks-safety
    rev: v1.3.3
    hooks:
      - id: python-safety-dependencies-check
        files: requirements.*\.txt$

  # PowerShell hooks - Disabled for pre-commit (environment-specific)
  # PowerShell linting still runs in CI via sonarcloud.yml workflow
  # - repo: local
  #   hooks:
  #     - id: psscriptanalyzer
  #       name: PSScriptAnalyzer
  #       entry: pwsh -Command "Invoke-ScriptAnalyzer -Path"
  #       language: system
  #       files: \.ps1$
  #       args: ['-Severity', 'Error']
  #     - id: powershell-format
  #       name: Format PowerShell
  #       entry: pwsh scripts/Format-PowerShellCode.ps1 -Check
  #       language: system
  #       files: \.(ps1|psm1)$
  #       pass_filenames: false

  # SQL hooks - Disabled for pre-commit (non-critical style checks)
  # SQL linting still runs in CI via sonarcloud.yml workflow
  # - repo: https://github.com/sqlfluff/sqlfluff
  #   rev: 3.0.0
  #   hooks:
  #     - id: sqlfluff-lint
  #       args: ['--dialect', 'postgres']
  #     - id: sqlfluff-fix
  #       args: ['--dialect', 'postgres']

  # Commit message validation
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v3.12.0
    hooks:
      - id: commitizen
        stages: [commit-msg]
